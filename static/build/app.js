loadFile({path:"/front/index.js",pathName:"/front/index.js",name:"index.js",dirName:"/front/",contents:'"use strict";window.app=require("../common/classes/app"),app.start();'}),loadFile({path:"/front/classes/dom-document.js",pathName:"/front/classes/dom-document.js",name:"dom-document.js",dirName:"/front/classes/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function checkScript(e){var t=this;return new Promise(function(n,r){var o=Array.from(document.querySelectorAll("script"));if(o.find(function(t){return t.getAttribute("src")==e}))n();else{var u=document.createElement("script");u.type="text/javascript",u.src=e,u.onload=function(){clearTimeout(c),n()},u.onreadystatechange=function(){"complete"==t.readyState&&(clearTimeout(c),n())},document.body.appendChild(u);var c=setTimeout(function(){r("can not load "+e)},15e3)}})}function loadStyles(e){return new Promise(function(t,n){var r=document.createElement("link");r.setAttribute("href",e),r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css");var o=void 0,u=void 0;"sheet"in r?(o="sheet",u="cssRules"):(o="styleSheet",u="rules");var c=setInterval(function(){r[o]&&(r[o][u]||[]).length&&(clearInterval(c),clearTimeout(i),t())},10),i=setTimeout(function(){clearInterval(c),clearTimeout(i),document.head.removeChild(r),n("can not load "+e)},15e3);document.head.appendChild(r)})}function checkStyles(e,t){return new Promise(function(n){t.styles?!function(){var t=Array.from(document.querySelectorAll("link[rel=stylesheet]")),r=build.prefix+"/"+bundleResult[e].styles;t.find(function(e){return e.getAttribute("href")==r})?n():loadStyles(r).then(n)}():n()})}function checkJS(e,t){if(t.js){var n=build.prefix+"/"+bundleResult[e].js;return checkScript(n)}return Promise.resolve()}function checkTemplates(e,t){if(t.templates){var n=build.prefix+"/"+bundleResult[e].templates;return checkScript(n)}return Promise.resolve()}function checkSVG(e,t){if(!t.svg)return Promise.resolve();var n=function(){var t=build.prefix+"/"+bundleResult[e].svg;return{v:new Promise(function(e){document.querySelector(\'[data-src="\'+t+\'"]\')?e():!function(){var n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onload=function(){var r=document.createElement("div");r.setAttribute("data-src",t),r.innerHTML=n.responseText,r.style.display="none",document.body.insertBefore(r,document.body.firstChild),e()}}()})}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},$=require("jquery"),process=require("process"),_=require("underscore"),bundleResult=require(process.cwd()+"/static/bundle-result"),build=require(process.cwd()+"/configuration/static");module.exports=function(){function e(t){_classCallCheck(this,e),this.theme=t}return _createClass(e,[{key:"loadTheme",value:function(){var e=this;return new Promise(function(t){_.pairs(e.theme.bundles).reduce(function(e,t){return e.then(function(){return Promise.all([checkStyles.apply(null,t),checkJS.apply(null,t),checkTemplates.apply(null,t),checkSVG.apply(null,t)])})},Promise.resolve()).then(t)})}},{key:"setBlock",value:function(e,t){$(document.all[e+"-block"]).html(t)}},{key:"setTitle",value:function(e){document.title=e}},{key:"setMeta",value:function(e){e instanceof Array&&(e=e.reduce(function(e,t){return e+"\\n"+t.toString()},"")),Array.from(document.head.querySelectorAll("meta")).forEach(function(e){document.head.removeChild(e)}),$(document.head).append(e)}},{key:"initViews",value:function(e){var t=this;e.forEach(function(e){new(require(t.theme.viewsPath+"/"+e))(t.theme)})}}]),e}();'}),loadFile({path:"/front/routers/base.js",pathName:"/front/routers/base.js",name:"base.js",dirName:"/front/routers/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){o=!0,i=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_=require("underscore"),EventEmitter=require("events"),commonEvents=require("../../common/events/common");module.exports=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return Object.assign(r,e),r._bindRoutes(),r}return _inherits(t,e),_createClass(t,[{key:"route",value:function(e,t,r){var n=this;return _.isRegExp(e)||(e=this._routeToRegExp(e)),_.isFunction(t)&&(r=t,t=""),r||(r=this[t]),app.resolve("history").then(function(o){o.route(e,function(o){var i=n._extractParameters(e,o);n.execute(r,i,t)!==!1&&(n.emit.apply(n,["route:"+t].concat(i)),n.emit("route",t,i),commonEvents.emit("route",n,t,i))})}),this}},{key:"execute",value:function(e,t,r){e&&e.apply(this,t)}},{key:"navigate",value:function(e,t){return app.resolve("history").then(function(r){r.navigate(e,t)}),this}},{key:"_bindRoutes",value:function(){if(this.routes){this.removeSlashes(),this.routes=_.result(this,"routes");for(var e=void 0,t=_.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}}},{key:"removeSlashes",value:function(){this.routes=_.pairs(this.routes).reduce(function(e,t){var r=_slicedToArray(t,2),n=r[0],o=r[1];return n.startsWith("/")&&(n=n.slice(1)),e[n]=o,e},{})}},{key:"_routeToRegExp",value:function(e){var t=/\\((.*?)\\)/g,r=/(\\(\\?)?:\\w+/g,n=/\\*\\w+/g,o=/[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;return e=e.replace(o,"\\\\$&").replace(t,"(?:$1)?").replace(r,function(e,t){return t?e:"([^/?]+)"}).replace(n,"([^?]*?)"),new RegExp("^"+e+"(?:\\\\?([\\\\s\\\\S]*))?$")}},{key:"_extractParameters",value:function(e,t){var r=this,n=e.exec(t).slice(1),o=_.pairs(this.routes).find(function(e){return r._routeToRegExp(e[0]).test(t)})[0],i=0,u={params:{},baseUrl:location.pathname,cookies:this.cookiesObj(),hostname:location.hostname,originalUrl:location.href.replace(location.origin,""),path:location.pathname,protocol:location.protocol,query:this.parseQuery(location.search)},a=e.exec(o.replace(/\\(|\\)/g,"")).slice(1);return[_.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}).filter(function(e){return!!e}).reduce(function(e,t,r){var n=(a[r]||"").slice(1);return":"!=(a[r]||"").slice(0,1)&&(n=i++),e.params[n]=t,e},u)]}},{key:"cookiesObj",value:function(){for(var e=document.cookie.split("; "),t={},r=0;r<e.length;r++){var n=e[r].split("=");t[n[0]]=n[1]}return t}},{key:"parseQuery",value:function(e){return e.replace("?","").split("&").filter(function(e){return!!e}).reduce(function(e,t){var r=t.split("=");return e[r[0]]=decodeURI(r[1]),e},{})}},{key:"loadPage",value:function(){commonEvents.emit("PageLoaded"),app.clientSide(function(){document.body.scrollTop=0})}}]),t}(EventEmitter);'}),loadFile({path:"/common/modules/template-engine/index.js",pathName:"/common/modules/template-engine/index.js",name:"index.js",dirName:"/common/modules/template-engine/",contents:'"use strict";var smartPlurals=require("smart-plurals"),_=require("underscore");if(require("jsmart"),"undefined"!=typeof window)var jSmart=window.jSmart;else jSmart=global.jSmart;module.exports={init:function(){function r(r){var t=app.get("i18n");return r=_.values(r).filter(function(r){return _.isString(r)}),t.translate.apply(t,r)}return jSmart.prototype.registerPlugin("function","pluralize",function(r){var t=app.get("i18n"),e=smartPlurals.Plurals.getRule(t.currentLanguage);return r=_.values(r).filter(function(r){return _.isString(r)||!isNaN(+r)}).map(function(r){return+r||r}),e.call(null,r[0],r.slice(1))}),jSmart.prototype.registerPlugin("function","translate",r),jSmart.prototype.registerPlugin("function","t",r),jSmart.prototype.registerPlugin("function","include",function(r,t){var e=require(app.get("commonPath")+"/views/base"),n=new e;return n.templateDirs=t.templateDirs,n.getTemplate(r.file,Object.assign(t,r))}),jSmart}};'}),loadFile({path:"/common/modules/server/index.js",pathName:"/common/modules/server/index.js",name:"index.js",dirName:"/common/modules/server/",contents:'"use strict";module.exports={init:function(){var i=void 0;return app.serverSide(function(){i=require("./lib/server")}),app.clientSide(function(){i=require("./lib/client")}),i.init()}};'}),loadFile({path:"/common/modules/socket-connection/lib/client.js",pathName:"/common/modules/socket-connection/lib/client.js",name:"client.js",dirName:"/common/modules/socket-connection/lib/",contents:'"use strict";var socket=require("socket.io-client/socket.io"),process=require("process"),config=require(process.cwd()+"/configuration/socket-server");module.exports=Object.setPrototypeOf({init:function(){return this.registerEvents(),this},registerEvents:function(){config.events(this)},emit:function(e,t,o){var n=require(app.get("commonPath")+"/events/common");"function"!=typeof o&&"function"!=typeof t||!function(){n.emit("SocketRequestStart",{event:e});var i="function"==typeof o?o:t,c=function(){n.emit("SocketRequestEnd",arguments),i.apply(null,arguments)};"function"==typeof t?t=c:o=c}();var i=Object.getPrototypeOf(this);"function"==typeof t?i.emit(e,t):i.emit(e,t,o)}},new socket(config.host+":"+config.port,{forceNew:!0}));'}),loadFile({path:"/common/modules/socket-connection/lib/server.js",pathName:"/common/modules/socket-connection/lib/server.js",name:"server.js",dirName:"/common/modules/socket-connection/lib/",contents:'"use strict";var server=app.get("server").httpServer,io=require("socket.io").listen(server),process=require("process"),config=require(process.cwd()+"/configuration/socket-server");io.on("connection",function(e){config.events(e)}),module.exports=Object.setPrototypeOf({init:function(){var e=this;return io.on("connection",function(o){e.events.forEach(function(e){o.on.apply(o,e)})}),this},events:[],on:function(){this.events.push(arguments),io.sockets.on.apply(io.sockets,arguments)}},io.sockets);'}),loadFile({path:"/common/modules/server/lib/client.js",pathName:"/common/modules/server/lib/client.js",name:"client.js",dirName:"/common/modules/server/lib/",contents:'"use strict";module.exports={init:function(){}};'}),loadFile({path:"/common/modules/server/lib/server.js",pathName:"/common/modules/server/lib/server.js",name:"server.js",dirName:"/common/modules/server/lib/",contents:'"use strict";module.exports={init:function(){var e=require("express"),r=e(),t=require("process"),i=require(t.cwd()+"/configuration/server");i.middleware(r);var s=i.port,n=i.host;return r.httpServer=r.listen(s,n,function(){console.log("start listening "+n+":"+s)}),r.use(e["static"](t.cwd()+"/static")),r}};'}),loadFile({path:"/common/mappers/base.js",pathName:"/common/mappers/base.js",name:"base.js",dirName:"/common/mappers/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),_=require("underscore");module.exports=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"find",value:function(){throw new Error("mapper should specify find method")}},{key:"findOne",value:function(){throw new Error("mapper should specify findOne method")}},{key:"fromQueryObject",value:function(){throw new Error("mapper should specify fromQueryObject method")}},{key:"populateModel",value:function(e){return _.extend(new this.model,e)}},{key:"parseAsModel",value:function(e){return e instanceof Array&&e.length?this.populateModel(e[0]):"object"==("undefined"==typeof e?"undefined":_typeof(e))&&Object.keys(e).length?this.populateModel(e):null}},{key:"parseAsCollection",value:function(e){return e=e.map(this.populateModel.bind(this)),new(this.collection.bind.apply(this.collection,[null].concat(e)))}},{key:"save",value:function(e){var t=void 0;if(t=this.validateModel(e))return e[this.PK]?this.update(t):this.insert(t);throw new Error("invalid data")}},{key:"validateModel",value:function(){throw new Error("mapper should specify validateModel method")}},{key:"insert",value:function(){throw new Error("mapper should specify insert method")}},{key:"update",value:function(){throw new Error("mapper should specify update method")}},{key:"collection",get:function(){return Array}},{key:"model",get:function(){throw new Error("mapper should specify model")}},{key:"fileName",get:function(){throw new Error("mapper should specify fileName")}},{key:"PK",get:function(){return((new this.model).primaryKey||_.noop)()||"id"}},{key:"validationErrors",get:function(){throw new Error("mapper should specify getter for validation errors")}}]),e}();'}),loadFile({path:"/common/mappers/knex-mapper.js",pathName:"/common/mappers/knex-mapper.js",name:"knex-mapper.js",dirName:"/common/mappers/",contents:'"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var u=r[t];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,u.key,u)}}return function(r,t,u){return t&&e(r.prototype,t),u&&e(r,u),r}}(),BaseMapper=require("./base"),EventEmitter=require("events"),_=require("underscore"),connections={};module.exports=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this));return t.config=e,t.knex=t.connection,t.schemaBuilder=t.knex.schema,t.emitter=new EventEmitter,t.tableChecked=new Promise(function(e){app.serverSide(function(){t.checkTable().then(e)}),app.clientSide(e)}),t}return _inherits(r,e),_createClass(r,[{key:"configToString",value:function(e){var r=this;return _.pairs(e).reduce(function(e,t){return _.isObject(t[1])?e+t[0]+r.configToString(t[1]):e+t[0]+t[1]},"")}},{key:"beforeQuery",value:function(e){return Promise.resolve()}},{key:"afterQuery",value:function(e){return Promise.resolve(e)}},{key:"checkTable",value:function(){var e=this;return this.schemaBuilder.hasTable(this.tableName).then(function(r){return r?void 0:e.schemaBuilder.createTableIfNotExists(e.tableName,function(r){e.beforeCreateTable(r),e.addColumns(r)}).then(function(){e.emit("table created")})})}},{key:"beforeCreateTable",value:function(e){}},{key:"addColumns",value:function(e){}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"emit",value:function(){return this.emitter.emit.apply(this.emitter,arguments)}},{key:"find",value:function(){return this.queryBuilder.select().dataParser(this.parseAsCollection.bind(this))}},{key:"findOne",value:function(){return this.queryBuilder.select().dataParser(this.parseAsModel.bind(this))}},{key:"fromQueryObject",value:function(e){return this.queryBuilder.fromQueryObject(e)}},{key:"insert",value:function(e){return this.queryBuilder.insert(e,this.PK).then(function(e){return e[0]})}},{key:"update",value:function(e){return this.queryBuilder.update(e,this.PK).where({id:e.id}).then(function(e){return e[0]||e})}},{key:"connection",get:function(){return connections[this.configToString(this.config)]||(connections[this.configToString(this.config)]=require("knex")(this.config))}},{key:"queryBuilder",get:function(){return new QueryBuilder(this.knex,this)}},{key:"tableName",get:function(){throw new Error("mapper should specify table name")}}]),r}(BaseMapper);var QueryBuilder=function(){function e(r,t){_classCallCheck(this,e),this.knex=r,this.queryBuilder=r(t.tableName),this.mapper=t}return _createClass(e,[{key:"parser",value:function(e){return e}},{key:"dataParser",value:function(e){return this.parser=e,this}},{key:"select",value:function(){return this.queryBuilder.select.apply(this.queryBuilder,arguments),this}},{key:"as",value:function(){return this.queryBuilder.as.apply(this.queryBuilder,arguments),this}},{key:"column",value:function(){return this.queryBuilder.column.apply(this.queryBuilder,arguments),this}},{key:"from",value:function(){return this.queryBuilder.from.apply(this.queryBuilder,arguments),this}},{key:"withSchema",value:function(){return this.queryBuilder.withSchema.apply(this.queryBuilder,arguments),this}},{key:"where",value:function(){return this.queryBuilder.where.apply(this.queryBuilder,arguments),this}},{key:"andWhere",value:function(){return this.queryBuilder.andWhere.apply(this.queryBuilder,arguments),this}},{key:"orWhere",value:function(){return this.queryBuilder.orWhere.apply(this.queryBuilder,arguments),this}},{key:"whereNot",value:function(){return this.queryBuilder.whereNot.apply(this.queryBuilder,arguments),this}},{key:"whereIn",value:function(){return this.queryBuilder.whereIn.apply(this.queryBuilder,arguments),this}},{key:"whereNotIn",value:function(){return this.queryBuilder.whereNotIn.apply(this.queryBuilder,arguments),this}},{key:"whereNull",value:function(){return this.queryBuilder.whereNull.apply(this.queryBuilder,arguments),this}},{key:"whereNotNull",value:function(){return this.queryBuilder.whereNotNull.apply(this.queryBuilder,arguments),this}},{key:"whereExists",value:function(){return this.queryBuilder.whereExists.apply(this.queryBuilder,arguments),this}},{key:"whereNotExists",value:function(){return this.queryBuilder.whereNotExists.apply(this.queryBuilder,arguments),this}},{key:"whereBetween",value:function(){return this.queryBuilder.whereBetween.apply(this.queryBuilder,arguments),this}},{key:"whereNotBetween",value:function(){return this.queryBuilder.whereNotBetween.apply(this.queryBuilder,arguments),this}},{key:"whereRaw",value:function(){return this.queryBuilder.whereRaw.apply(this.queryBuilder,arguments),this}},{key:"innerJoin",value:function(){return this.queryBuilder.innerJoin.apply(this.queryBuilder,arguments),this}},{key:"leftJoin",value:function(){return this.queryBuilder.leftJoin.apply(this.queryBuilder,arguments),this}},{key:"leftOuterJoin",value:function(){return this.queryBuilder.leftOuterJoin.apply(this.queryBuilder,arguments),this}},{key:"rightJoin",value:function(){return this.queryBuilder.rightJoin.apply(this.queryBuilder,arguments),this}},{key:"rightOuterJoin",value:function(){return this.queryBuilder.rightOuterJoin.apply(this.queryBuilder,arguments),this}},{key:"outerJoin",value:function(){return this.queryBuilder.outerJoin.apply(this.queryBuilder,arguments),this}},{key:"fullOuterJoin",value:function(){return this.queryBuilder.fullOuterJoin.apply(this.queryBuilder,arguments),this}},{key:"crossJoin",value:function(){return this.queryBuilder.crossJoin.apply(this.queryBuilder,arguments),this}},{key:"joinRaw",value:function(){return this.queryBuilder.joinRaw.apply(this.queryBuilder,arguments),this}},{key:"distinct",value:function(){return this.queryBuilder.distinct.apply(this.queryBuilder,arguments),this}},{key:"groupBy",value:function(){return this.queryBuilder.groupBy.apply(this.queryBuilder,arguments),this}},{key:"groupByRaw",value:function(){return this.queryBuilder.groupByRaw.apply(this.queryBuilder,arguments),this}},{key:"orderBy",value:function(){return this.queryBuilder.orderBy.apply(this.queryBuilder,arguments),this}},{key:"orderByRaw",value:function(){return this.queryBuilder.orderByRaw.apply(this.queryBuilder,arguments),this}},{key:"having",value:function(){return this.queryBuilder.having.apply(this.queryBuilder,arguments),this}},{key:"offset",value:function(){return this.queryBuilder.offset.apply(this.queryBuilder,arguments),this}},{key:"limit",value:function(){return this.queryBuilder.limit.apply(this.queryBuilder,arguments),this}},{key:"union",value:function(){return this.queryBuilder.union.apply(this.queryBuilder,arguments),this}},{key:"unionAll",value:function(){return this.queryBuilder.unionAll.apply(this.queryBuilder,arguments),this}},{key:"insert",value:function(){return this.queryBuilder.insert.apply(this.queryBuilder,arguments),this}},{key:"returning",value:function(){return this.queryBuilder.returning.apply(this.queryBuilder,arguments),this}},{key:"update",value:function(){return this.queryBuilder.update.apply(this.queryBuilder,arguments),this}},{key:"del",value:function(){return this.queryBuilder.del.apply(this.queryBuilder,arguments),this}},{key:"transaction",value:function(){return this.queryBuilder.transaction.apply(this.queryBuilder,arguments),this}},{key:"transacting",value:function(){return this.queryBuilder.transacting.apply(this.queryBuilder,arguments),this}},{key:"forUpdate",value:function(){return this.queryBuilder.forUpdate.apply(this.queryBuilder,arguments),this}},{key:"forShare",value:function(){return this.queryBuilder.forShare.apply(this.queryBuilder,arguments),this}},{key:"count",value:function(){return this.queryBuilder.count.apply(this.queryBuilder,arguments),this}},{key:"min",value:function(){return this.queryBuilder.min.apply(this.queryBuilder,arguments),this}},{key:"max",value:function(){return this.queryBuilder.max.apply(this.queryBuilder,arguments),this}},{key:"sum",value:function(){return this.queryBuilder.sum.apply(this.queryBuilder,arguments),this}},{key:"increment",value:function(){return this.queryBuilder.increment.apply(this.queryBuilder,arguments),this}},{key:"decrement",value:function(){return this.queryBuilder.decrement.apply(this.queryBuilder,arguments),this}},{key:"truncate",value:function(){return this.queryBuilder.truncate.apply(this.queryBuilder,arguments),this}},{key:"pluck",value:function(){return this.queryBuilder.pluck.apply(this.queryBuilder,arguments),this}},{key:"first",value:function(){return this.queryBuilder.first.apply(this.queryBuilder,arguments),this}},{key:"clone",value:function(){return this.queryBuilder.clone.apply(this.queryBuilder,arguments),this}},{key:"modify",value:function(){return this.queryBuilder.modify.apply(this.queryBuilder,arguments),this}},{key:"columnInfo",value:function(){return this.queryBuilder.columnInfo.apply(this.queryBuilder,arguments),this}},{key:"debug",value:function(){return this.queryBuilder.debug.apply(this.queryBuilder,arguments),this}},{key:"connection",value:function(){return this.queryBuilder.connection.apply(this.queryBuilder,arguments),this}},{key:"options",value:function(){return this.queryBuilder.options.apply(this.queryBuilder,arguments),this}},{key:"then",value:function(e){var r=this,t=this.mapper.cacheEngine,u=this.toString().includes("select "),i=!1;return this.mapper.tableChecked.then(function(){return r.mapper.beforeQuery(r)}).then(function(){if(t){if(u){var e=r.toString();return t.get(e).then(function(e){return e?(i=!0,r.parser(e)):void 0})}(r.mapper.clearCache||_.noop)()}}).then(function(e){return e?e:new Promise(function(e,t){app.serverSide(function(){r.serverQuery(e)}),app.clientSide(function(){r.clientQuery(e,t)})})}).then(function(e){if(t&&u){var n=r.toString();!i&&e&&t.set(n,e)}return r.mapper.afterQuery(e)}).then(function(r){return e(r)})}},{key:"serverQuery",value:function(e){var r=this;this.queryBuilder.then(function(t){e(r.parser(t))})}},{key:"clientQuery",value:function(e,r){var t=this,u=app.get("socketConnection"),i={mapper:this.mapper.fileName,queryObject:this.toQueryObject()};u.emit("query",i,function(u,i){u?r(u):e(t.parser(i))})}},{key:"toQueryObject",value:function(){var e=this,r={};return Object.keys(this.queryBuilder).filter(function(e){return"_"==e[0]}).forEach(function(t){return r[t]=e.queryBuilder[t]}),r=this.stringifyFunc(r)}},{key:"traverse",value:function(e,r){var t=this;return _.mapObject(e,function(e,u,i){if("object"==("undefined"==typeof e?"undefined":_typeof(e))&&e!=i){var n=t.traverse(e,r);return e instanceof Array?_.values(n):n}return r(e)})}},{key:"stringifyFunc",value:function(e){return this.traverse(e,function(e){return _.isFunction(e)?e.toString():e})}},{key:"parseFunc",value:function(e){return this.traverse(e,function(e){return"string"==typeof e&&e.includes("function")?new Function(e.replace(/\\n/g," ").match(/{(.*)}/)[1]):e})}},{key:"toString",value:function(){return this.queryBuilder.toString()}},{key:"boolify",value:function(e){return this.traverse(e,function(e){return"false"===e?!1:"true"===e?!0:e})}},{key:"fromQueryObject",value:function(e){e=this.parseFunc(e),e=this.boolify(e),Object.assign(this.queryBuilder,e);var r=this.queryBuilder.toString();if(this.validateQuery(r))return this.queryBuilder.then(function(e){return e});throw new Error("invalid query")}},{key:"validateQuery",value:function(e){return this.mapper.validateQuery?this.mapper.validateQuery(e):!/\\bjoin\\b|\\bunion\\b|\\binsert\\b|\\bupdate\\b|\\bdelete\\b/gi.test(e)&&new RegExp("from\\\\s+\\\\S*"+this.mapper.tableName+"\\\\S*").test(e)}}]),e}();'}),loadFile({path:"/common/classes/ajax-response.js",pathName:"/common/classes/ajax-response.js",name:"ajax-response.js",dirName:"/common/classes/",contents:'"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();module.exports=function(){function t(){_classCallCheck(this,t),this.status=null,this.errors=null,this.data=null}return _createClass(t,null,[{key:"statusOK",get:function(){return"success"}},{key:"statusError",get:function(){return"error"}}]),t}();'}),loadFile({path:"/common/classes/app.js",pathName:"/common/classes/app.js",name:"app.js",dirName:"/common/classes/",contents:'"use strict";var process=require("process"),_=require("underscore"),commonEvents=require("../events/common"),configuration=require(process.cwd()+"/configuration/app");module.exports={start:function(){var n=this;return this.setVars(),new Promise(function(t){n.clientSide(function(){window.addEventListener("load",t)}),n.serverSide(t)}).then(function(){configuration.beforeStart(),n.loadComponents(),configuration.afterStart()})["catch"](function(n){console.log(n)}),this},set:function(n,t){this[n]=t},get:function(n){return this[n]},resolve:function(n){var t=this;return new Promise(function(e){t[n]?e(t[n]):commonEvents.on("init "+n,function(){e(t[n])})})},setVars:function(){var n=this;this.clientSide(function(){n.set("classPath","/front")}),this.serverSide(function(){n.set("classPath",process.cwd()+"/back")}),this.set("commonPath",process.cwd()+"/common")},loadComponents:function(){var n=this,t=require(process.cwd()+"/configuration/components");_.pairs(t).forEach(function(t){n.set(t[0],t[1].init()),commonEvents.emit("init "+t[0])}),commonEvents.emit("ComponentsLoaded")},serverSide:function(n){"undefined"!=typeof global&&n()},clientSide:function(n){"undefined"!=typeof window&&n()}};'}),loadFile({path:"/common/events/common.js",pathName:"/common/events/common.js",name:"common.js",dirName:"/common/events/",contents:'"use strict";var EventEmitter=require("events"),event=new EventEmitter;"undefined"!=typeof window&&(window.addEventListener("error",function(e){event.emit("error",e)}),window.onerror=function(e){return event.emit("error",e)}),module.exports=event;'}),loadFile({path:"/common/routers/get.js",pathName:"/common/routers/get.js",name:"get.js",dirName:"/common/routers/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),BaseRouter=require(app.get("classPath")+"/routers/base"),process=require("process"),theme=require(process.cwd()+"/configuration/theme-light");module.exports=function(e){function t(e,r){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n.DomDocument=r||require(app.get("classPath")+"/classes/dom-document"),n}return _inherits(t,e),_createClass(t,[{key:"index",value:function(e,t){var r=this,n=new(require("../views/main-page"))(theme),o=new this.DomDocument(theme);n.render().then(function(e){o.setBlock("main",e),r.loadPage(o,t)})}}]),t}(BaseRouter);'}),loadFile({path:"/common/modules/i18n/index.js",pathName:"/common/modules/i18n/index.js",name:"index.js",dirName:"/common/modules/i18n/",contents:'"use strict";var process=require("process"),config=require(process.cwd()+"/configuration/i18n");module.exports={translate:function(t,e,n){var r=n||this.currentLanguage,c=this.loadSection(t,r);return c?c[e]||e:e},t:function(){return this.translate.apply(this,arguments)},get currentLanguage(){return config.currentLanguage},get sourceLanguage(){return config.sourceLanguage},get loadSection(){return config.loadSection},init:function(){return this}};'}),loadFile({path:"/common/modules/history/index.js",pathName:"/common/modules/history/index.js",name:"index.js",dirName:"/common/modules/history/",contents:'"use strict";var _=require("underscore"),routeStripper=/^[#\\/]|\\s+$/g,rootStripper=/^\\/+|\\/+$/g,pathStripper=/#.*$/;module.exports={handlers:[],get checkUrl(){return this._checkUrl.bind(this)},get location(){return window.location},get history(){return window.history},started:!1,interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(routeStripper,"")},start:function(t){if(this.started)throw new Error("history has already been started");if(this.started=!0,this.applyOptions(t),this.root=("/"+this.root+"/").replace(rootStripper,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}return this.hashChangeSupport(),this.urlStateListeners(),this.options.silent?void 0:this.loadUrl()},applyOptions:function(t){this.options=_.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment()},hashChangeSupport:function(){if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var t=document.body,e=t.insertBefore(this.iframe,t.firstChild).contentWindow;e.document.open(),e.document.close(),e.location.hash="#"+this.fragment}},urlStateListeners:function(){var t=window.addEventListener||function(t,e){return window.attachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?t("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval))},stop:function(){this.removeListeners(),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),this.started=!1},removeListeners:function(){var t=window.removeEventListener||function(t,e){return window.detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1)},route:function(t,e){this.handlers.unshift({route:t,callback:e})},_checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return this.matchRoot()?(t=this.fragment=this.getFragment(t),this.handlers.some(function(e){return e.route.test(t)?(e.callback(t),!0):void 0})):!1},navigate:function(t,e){if(!this.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var s=i+t;if(t=this.decodeFragment(t.replace(pathStripper,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,s);else{if(!this._wantsHashChange)return this.location.assign(s);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var a=this.iframe.contentWindow;e.replace||(a.document.open(),a.document.close()),this._updateHash(a.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var s=t.href.replace(/(javascript:|#).*$/,"");t.replace(s+"#"+e)}else t.hash="#"+e},init:function(){var t=this;return this.setRoutes(),app.clientSide(function(){t.registerEvents(),t.start({pushState:!0,silent:!0})}),this},setRoutes:function(){var t=require("process"),e=require(t.cwd()+"/configuration/routes"),i=require("fs");_.pairs(e).forEach(function(t){for(var e=[app.get("commonPath"),app.get("classPath")],s=void 0,a=void 0;s=e.shift();){a=s+"/routers/"+t[0]+".js";try{i.accessSync(a)}catch(h){continue}var r=require(a);new r({routes:t[1]});break}})},registerEvents:function(){var t=this,e=require("jquery");e(document).on("click","a[href]:not(.link_external)",function(e){var i=e.currentTarget,s=i.getAttribute("href"),a=-1==s.indexOf("http")&&-1==s.indexOf("www")&&-1==s.indexOf("javascript");a&&(e.preventDefault(),t.navigate(s,{trigger:!0}))})}};'
}),loadFile({path:"/common/modules/meta/index.js",pathName:"/common/modules/meta/index.js",name:"index.js",dirName:"/common/modules/meta/",contents:'"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_=require("underscore"),Tag=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"toString",value:function(){return["<meta"].concat(_.pairs(this.attributes).map(function(t){return" "+t[0]+\'="\'+t[1]+\'" \'})).concat(">").join("")}},{key:"attributes",get:function(){return this._attributes||(this._attributes={},this._attributes)},set:function(t){this._attributes=t}}]),t}();exports.Tag=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return r.attributes=t,r}return _inherits(e,t),e}(Tag),exports.Description=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return r.attributes.content=t,r.attributes.name="description",r}return _inherits(e,t),e}(Tag),exports.Charset=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return r.attributes.charset=t,r}return _inherits(e,t),e}(Tag),exports.Keywords=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));if(r.attributes.name="keywords","string"==typeof t)r.attributes.content=t;else{if(!(t instanceof Array))throw new Error("keywords must be either string or array");r.attributes.content=t.join(", ")}return r}return _inherits(e,t),e}(Tag);'}),loadFile({path:"/common/modules/socket-connection/index.js",pathName:"/common/modules/socket-connection/index.js",name:"index.js",dirName:"/common/modules/socket-connection/",contents:'"use strict";module.exports={init:function(){var i=void 0;return app.clientSide(function(){i=require("./lib/client")}),app.serverSide(function(){i=require("./lib/server")}),i.init()}};'}),loadFile({path:"/common/views/base.js",pathName:"/common/views/base.js",name:"base.js",dirName:"/common/views/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),fs=require("fs"),_=require("underscore");module.exports=function(){function e(){var t=this;_classCallCheck(this,e),app.clientSide(function(){t.cid=_.uniqueId("view"),t._ensureElement()})}return _createClass(e,[{key:"$",value:function(e){return this.$el.find(e)}},{key:"render",value:function(){}},{key:"remove",value:function(){return this._removeElement(),this}},{key:"_removeElement",value:function(){this.$el.remove()}},{key:"setElement",value:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this}},{key:"_setElement",value:function(e){var t=require("jquery");this.$el=e instanceof t?e:t(e)}},{key:"delegateEvents",value:function(e){if(e||(e=_.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(_.isFunction(i)||(i=this[i]),!i)continue;var n=t.match(/^(\\S+)\\s*(.*)$/);this.delegate(n[1],n[2],_.bind(i,this))}return this}},{key:"delegate",value:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this}},{key:"undelegateEvents",value:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this}},{key:"undelegate",value:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this}},{key:"_createElement",value:function(e){return document.createElement(e)}},{key:"_ensureElement",value:function(){if(this.el)this.setElement(_.result(this,"el"));else{var e=_.extend({},_.result(this,"attributes"));this.id&&(e.id=_.result(this,"id")),this.className&&(e["class"]=_.result(this,"className")),this.setElement(this._createElement(_.result(this,"tagName"))),this._setAttributes(e)}}},{key:"_setAttributes",value:function(e){this.$el.attr(e)}},{key:"setTemplateDir",value:function(e){return _.isArray(e)?this.templateDirs=e:this.templateDirs=[e],this}},{key:"addTemplateDir",value:function(e){return!this.templateDirs&&(this.templateDirs=[]),_.isArray(e)?this.templateDirs.concat(e):this.templateDirs.push(e),this}},{key:"getTemplate",value:function(e,t){for(var i in this.templateDirs)if(this.templateDirs.hasOwnProperty(i)){var n=this.templateDirs[i],s=fs.readdirSync(n),r=n+"/"+e;if(s.find(function(t){return t==e})){var a=fs.readFileSync(r,"utf8");return this.compile(a,t)}}throw new Error("cannot find template "+e)}},{key:"compile",value:function(e,t){var i=app.get("templateEngine"),n=new i(e);return n.fetch(Object.assign(t||{},{templateDirs:this.templateDirs}))}},{key:"tagName",get:function(){return"div"}}]),e}();'}),loadFile({path:"/common/views/file-upload-form.js",pathName:"/common/views/file-upload-form.js",name:"file-upload-form.js",dirName:"/common/views/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},FormView=require("./form"),$=require("jquery"),_=require("underscore");module.exports=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"filesToObj",value:function(){return _.mapObject(this.files,function(e){return e.map(function(e){for(var t=e,r=0,n=[];t&&!(++r>300);)t=Object.getPrototypeOf(t),n=n.concat(Object.keys(t||{}));return _.uniq(n).reduce(function(t,r){return t[r]=e[r],t},{})})})}},{key:"serializeData",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"serializeData",this).apply(this,arguments);return Object.assign(e,this.filesToObj())}},{key:"addFiles",value:function(e){var t=e.currentTarget;if(this.files||(this.files={}),t.files.length){var r=t.name,n=Array.from(t.files);if(this.concatFiles){var i=this.files[r]||[];this.files[r]=i.concat(n)}else this.files[r]=n}this.onFileSelect(e)}},{key:"onFileSelect",value:function(){}},{key:"removeFile",value:function(e){for(var t in this.files)if(this.files.hasOwnProperty(t)){var r=this.files[t];if(r.indexOf(e)>-1){r.splice(r.indexOf(e),1);break}}}},{key:"clearFiles",value:function(){this.files={}}},{key:"processData",value:function(e,t){var r=this;return e=Object.assign(e,this.files||{}),_.pairs(e).reduce(function(e,t){return t[1]instanceof Array?!function(){var n=t[0];_.pairs(t[1]).forEach(function(t){if(t[1]instanceof File){var i=t[1],o=r.formDataFileName(i,n);e.append(o,i)}else e.append(n,t[1])})}():e.append(t[0],t[1]),e},new FormData)}},{key:"formDataFileName",value:function(e,t){return t}},{key:"send",value:function(e,t){var r=this.onProgress.bind(this);return $.ajax({url:e,type:"post",xhr:function n(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",r,!1),n},data:t,cache:!1,contentType:!1,processData:!1},"json")}},{key:"onProgress",value:function(){}},{key:"events",get:function(){return Object.assign(_get(Object.getPrototypeOf(t.prototype),"events",this),{"change input[type=file]":"addFiles"})}},{key:"concatFiles",get:function(){return!0}}]),t}(FormView);'}),loadFile({path:"/common/views/form.js",pathName:"/common/views/form.js",name:"form.js",dirName:"/common/views/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),BaseView=require("./base"),$=require("jquery"),AjaxResponse=require("../classes/ajax-response");module.exports=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.disable(),e.waitForDependencies().then(e.enable.bind(e)),e}return _inherits(t,e),_createClass(t,[{key:"disable",value:function(){this.$("button, [type=submit]").attr("disabled","true")}},{key:"enable",value:function(){this.$("button, [type=submit]").removeAttr("disabled")}},{key:"showProgress",value:function(){}},{key:"hideProgress",value:function(){}},{key:"waitForDependencies",value:function(){return new Promise(function(e){var t=require("../events/common");app.get("validationEngine")?e():t.on("init validationEngine",e)})}},{key:"submit",value:function(e){var t=this;e.preventDefault(),this.waitForDependencies().then(function(){var n=e.target,r=t.validate(t.serializeData(n));r?t.send(n.action,t.processData(r,n)).then(function(e){t.isRequestSuccess(e)?t.onSuccess(e):t.onError(e)}):t.onValidationError()})}},{key:"processData",value:function(e){return e}},{key:"isRequestSuccess",value:function(e){return e.status==AjaxResponse.statusOK}},{key:"onSuccess",value:function(){}},{key:"onError",value:function(){}},{key:"serializeData",value:function(e){return this.toJSON(e)}},{key:"send",value:function(e,t){var n=this,r=this.showProgress.bind(this);return $.ajax({url:e,xhr:function a(){var a=new XMLHttpRequest;return r(a),a},data:t,dataType:"json"}).then(function(e){return n.hideProgress(),e}).fail(function(e){n.hideProgress()})}},{key:"toJSON",value:function(e){var t={},n={},r={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,key:/[a-zA-Z0-9_-]+|(?=\\[\\])/g,push:/^$/,fixed:/^\\d+$/,named:/^[a-zA-Z0-9_]+$/},a=function(e,t,n){return e[t]=n,e},i=function(e){return void 0===n[e]&&(n[e]=0),n[e]++};return $.each($(e).serializeArray().concat(this.getUncheckedCheckboxes()),function(){if(r.validate.test(this.name)){for(var e=void 0,n=this.name.match(r.key),o=this.value,s=this.name;void 0!==(e=n.pop());)s=s.replace(new RegExp("\\\\["+e+"\\\\]$"),""),e.match(r.push)?o=a([],i(s),o):e.match(r.fixed)?o=a([],e,o):e.match(r.named)&&(o=a({},e,o));t=$.extend(!0,t,o)}}),t}},{key:"getUncheckedCheckboxes",value:function(){return this.$("[type=checkbox]:not(:checked)").toArray().map(function(e){return{name:e.name,value:""}})}},{key:"validate",value:function(e){return e}},{key:"onValidationError",value:function(){}},{key:"events",get:function(){return{submit:"submit"}}}]),t}(BaseView);'}),loadFile({path:"/common/views/main-page.js",pathName:"/common/views/main-page.js",name:"main-page.js",dirName:"/common/views/",contents:'"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),BaseView=require("./base");module.exports=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return r.setTemplateDir(e.templatesPath+"/main-page"),r}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this;return new Promise(function(t){var r=e.getTemplate("index.tpl.html");t(r)})}}]),t}(BaseView);'}),loadFile({path:"/common/modules/validation-engine/index.js",pathName:"/common/modules/validation-engine/index.js",name:"index.js",dirName:"/common/modules/validation-engine/",contents:'"use strict";var LIVR=require("livr");module.exports={init:function(){return LIVR.Validator.defaultAutoTrim(!0),LIVR.Validator}};'}),loadFile({path:"/configuration/routes.js",pathName:"/configuration/routes.js",name:"routes.js",dirName:"/configuration/",contents:'"use strict";module.exports={get:{"/":"index"}};'}),loadFile({path:"/configuration/runtime.js",pathName:"/configuration/runtime.js",name:"runtime.js",dirName:"/configuration/",contents:'"use strict";var process=require("process");module.exports={main:process.cwd()+"/front/index.js"};'}),loadFile({path:"/configuration/components.js",pathName:"/configuration/components.js",name:"components.js",dirName:"/configuration/",contents:'"use strict";module.exports={server:require(app.get("commonPath")+"/modules/server"),socketConnection:require(app.get("commonPath")+"/modules/socket-connection"),templateEngine:require(app.get("commonPath")+"/modules/template-engine"),validationEngine:require(app.get("commonPath")+"/modules/validation-engine"),i18n:require(app.get("commonPath")+"/modules/i18n"),history:require(app.get("commonPath")+"/modules/history")};'}),loadFile({path:"/configuration/static.js",pathName:"/configuration/static.js",name:"static.js",dirName:"/configuration/",contents:'"use strict";var process=require("process");module.exports={build:process.cwd()+"/static/build",bundleResult:process.cwd()+"/static/bundle-result.js",clean:"static/build/*",prefix:"/build"};'}),loadFile({path:"/configuration/theme-light.js",pathName:"/configuration/theme-light.js",name:"theme-light.js",dirName:"/configuration/",contents:'"use strict";var process=require("process"),themePath=process.cwd()+"/themes/theme-light",templatesPath=themePath+"/templates",stylesPath=themePath+"/styles",viewsPath=themePath+"/js/views";try{var lazypipe=require("lazypipe"),stylus=require("gulp-stylus"),nib=require("nib"),bundleOptions={minifyTemplates:!0,watchTemplates:!0,minifyStyles:!0,watchStyles:!0,transforms:{styles:lazypipe().pipe(stylus,{include:[themePath+"/includes/stylus"],"import":["_variables","nib"],use:nib()})}}}catch(e){bundleOptions={}}module.exports={path:themePath,templatesPath:templatesPath,viewsPath:viewsPath,bundles:{"theme-light":{templates:[templatesPath+"/**/*.tpl.html"],styles:[stylesPath+"/**/*.styl"],options:Object.assign({},bundleOptions)}}};'}),loadFile({path:"/configuration/i18n.js",pathName:"/configuration/i18n.js",name:"i18n.js",dirName:"/configuration/",contents:'"use strict";module.exports={sourceLanguage:"ru",currentLanguage:"ru",loadSection:function(u,e){}};'}),loadFile({path:"/configuration/socket-server.js",pathName:"/configuration/socket-server.js",name:"socket-server.js",dirName:"/configuration/",contents:'"use strict";module.exports={get host(){return location.protocol+"//"+location.hostname},get port(){return location.port||8e3},events:function(e){e.on("query",function(e,t){for(var r=e.mapper,n=void 0,o=[app.get("commonPath"),app.get("classPath")],c=require("fs");n=o.shift();){var a=c.readdirSync(n),s=a.find(function(e){return"mappers"==e}),i=s&&c.readdirSync(n+"/mappers"),u=i&&i.find(function(e){return e.includes(r)});if(u){var p=new(require(n+"/mappers/"+r));try{return p.fromQueryObject(e.queryObject).then(function(e){t(null,e)})}catch(f){t({message:f.message,stack:f.stack})}}}t({message:"mapper "+r+" does not exist"})})}};'}),loadFile({path:"/configuration/app.js",pathName:"/configuration/app.js",name:"app.js",dirName:"/configuration/",contents:'"use strict";module.exports={beforeStart:function(){},afterStart:function(){}};'});